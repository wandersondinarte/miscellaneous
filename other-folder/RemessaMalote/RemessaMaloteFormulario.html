
<!DOCTYPE html>
<html>
<head>
  <title>Formulário de Remessa de Malotes</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

  <div class="container">
    <h1>Formulário de Remessa de Malotes</h1>

    <!-- Formulário de inclusão -->
    <form id="form-inclusao">
      <h2>Inclusão de Solicitação</h2>
      <div class="form-group">
        <label for="cdSolicitacao">Código da Solicitação:</label>
        <input type="text" class="form-control" id="cdSolicitacao" name="cdSolicitacao">
      </div>
      <div class="form-group">
        <label for="cdUsuario">Código do Usuário:</label>
        <input type="text" class="form-control" id="cdUsuario" name="cdUsuario">
      </div>
      <div class="form-group">
        <label for="cdMalote">Código do Malote:</label>
        <input type="text" class="form-control" id="cdMalote" name="cdMalote">
      </div>
      <div class="form-group">
        <label for="dtEnvio">Data de Envio:</label>
        <input type="date" class="form-control" id="dtEnvio" name="dtEnvio">
      </div>
      <div class="form-group">
        <label for="cdDestino">Código do Destino:</label>
        <input type="text" class="form-control" id="cdDestino" name="cdDestino">
      </div>
      <div class="form-group">
        <label for="fgDestino">Destino:</label>
        <input type="text" class="form-control" id="fgDestino" name="fgDestino">
      </div>
      <div class="form-group">
        <label for="dsObservacoes">Observações:</label>
        <textarea class="form-control" id="dsObservacoes" name="dsObservacoes"></textarea>
      </div>
      <div class="form-group">
        <label for="dtSolicitacao">Data da Solicitação:</label>
        <input type="date" class="form-control" id="dtSolicitacao" name="dtSolicitacao">
      </div>
      <div class="form-group">
        <label for="dtConclusao">Data da Conclusão:</label>
        <input type="date" class="form-control" id="dtConclusao" name="dtConclusao">
      </div>
      <div class="form-group">
        <label for="fgConclusao">Conclusão:</label>
        <input type="text" class="form-control" id="fgConclusao" name="fgConclusao">
      </div>
      <div class="form-group">
        <label for="dtUltimaModificacao">Data da Última Modificação:</label>
        <input type="date" class="form-control" id="dtUltimaModificacao" name="dtUltimaModificacao">
      </div>
      <button type="submit" class="btn btn-primary">Incluir</button>
    </form>

    <!-- Formulário de edição -->
    <form id="form-edicao">
      <h2>Edição de Solicitação</h2>
      <div class="form-group">
        <label for="cdSolicitacaoEditar">Código da Solicitação:</label>
        <input type="text" class="form-control" id="cdSolicitacaoEditar" name="cdSolicitacaoEditar">
      </div>
      <div class="form-group">
        <label for="cdUsuarioEditar">Código do Usuário:</label>
        <input type="text" class="form-control" id="cdUsuarioEditar" name="cdUsuarioEditar">
      </div>
      <div class="form-group">
        <label for="cdMaloteEditar">Código do Malote:</label>
        <input type="text" class="form-control" id="cdMaloteEditar" name="cdMaloteEditar">
      </div>
      <div class="form-group">
        <label for="dtEnvioEditar">Data de Envio:</label>
        <input type="date" class="form-control" id="dtEnvioEditar" name="dtEnvioEditar">
      </div>
      <div class="form-group">
        <label for="cdDestinoEditar">Código do Destino:</label>
        <input type="text" class="form-control" id="cdDestinoEditar" name="cdDestinoEditar">
      </div>
      <div class="form-group">
        <label for="fgDestinoEditar">Destino:</label>
        <input type="text" class="form-control" id="fgDestinoEditar" name="fgDestinoEditar">
      </div>
      <div class="form-group">
        <label for="dsObservacoesEditar">Observações:</label>
        <textarea class="form-control" id="dsObservacoesEditar" name="dsObservacoesEditar"></textarea>
      </div>
      <div class="form-group">
        <label for="dtSolicitacaoEditar">Data da Solicitação:</label>
        <input type="date" class="form-control" id="dtSolicitacaoEditar" name="dtSolicitacaoEditar">
      </div>
      <div class="form-group">
        <label for="dtConclusaoEditar">Data da Conclusão:</label>
        <input type="date" class="form-control" id="dtConclusaoEditar" name="dtConclusaoEditar">
      </div>
      <div class="form-group">
        <label for="fgConclusaoEditar">Conclusão:</label>
        <input type="text" class="form-control" id="fgConclusaoEditar" name="fgConclusaoEditar">
      </div>
      <div class="form-group">
        <label for="dtUltimaModificacaoEditar">Data da Última Modificação:</label>
        <input type="date" class="form-control" id="dtUltimaModificacaoEditar" name="dtUltimaModificacaoEditar">
      </div>
      <button type="submit" class="btn btn-primary">Atualizar</button>
    </form>

    <!-- Tabela de listagem de solicitações -->
    <h2>Lista de Solicitações</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Código</th>
          <th>Usuário</th>
          <th>Malote</th>
          <th>Data de Envio</th>
          <th>Destino</th>
          <th>Observações</th>
          <th>Data da Solicitação</th>
          <th>Data da Conclusão</th>
          <th>Conclusão</th>
          <th>Data da Última Modificação</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="lista-solicitacoes">
      </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script>
      $(document).ready(function() {
        // Função para carregar a lista de solicitações
        function carregarSolicitacoes() {
          $.ajax({
            url: 'listar_solicitacoes.php',
            method: 'GET',
            success: function(data) {
              $('#lista-solicitacoes').html(data);
            }
          });
        }

        // Carrega a lista de solicitações ao carregar a página
        carregarSolicitacoes();

        // Função para incluir solicitação
        $('#form-inclusao').submit(function(event) {
          event.preventDefault();
          $.ajax({
            url: 'incluir_solicitacao.php',
            method: 'POST',
            data: $('#form-inclusao').serialize(),
            success: function(data) {
              $('#form-inclusao')[0].reset();
              carregarSolicitacoes();
            }
          });
        });

        // Função para excluir solicitação
        $('#lista-solicitacoes').on('click', '.excluir-solicitacao', function() {
          var cdSolicitacao = $(this).data('cd-solicitacao');
          if (confirm('Deseja realmente excluir esta solicitação?')) {
            $.ajax({
              url: 'excluir_solicitacao.php',
              method: 'POST',
              data: {
                cdSolicitacao: cdSolicitacao
              },
              success: function(data) {
                carregarSolicitacoes();
              }
            });
          }
        });

        // Função para carregar dados da solicitação no formulário de edição
        $('#lista-solicitacoes').on('click', '.editar-solicitacao', function() {
          var cdSolicitacao = $(this).data('cd-solicitacao');
          $.ajax({
            url: 'buscar_solicitacao.php',
            method: 'POST',
            data: {
              cdSolicitacao: cdSolicitacao
            },
            dataType: 'json',
            success: function(data) {
              $('#cdSolicitacaoEditar').val(data.cdSolicitacao);
              $('#cdUsuarioEditar').val(data.cdUsuario);
              $('#cdMaloteEditar').val(data.cdMalote);
              $('#dtEnvioEditar').val(data.dtEnvio);
              $('#cdDestinoEditar').val(data.cdDestino);
              $('#fgDestinoEditar').val(data.fgDestino);
              $('#dsObservacoesEditar').val(data.dsObservacoes);
              $('#dtSolicitacaoEditar').val(data.dtSolicitacao);
              $('#dtConclusaoEditar').val(data.dtConclusao);
              $('#fgConclusaoEditar').val(data.fgConclusao);
              $('#dtUltimaModificacaoEditar').val(data.dtUltimaModificacao);
              $('#modalEditarSolicitacao').modal('show');
            }
          });
        });

        // Função para atualizar solicitação
        $('#form-edicao').submit(function(event) {
          event.preventDefault();
          $.ajax({
            url: 'atualizar_solicitacao.php',
            method: 'POST',
            data: $('#form-edicao').serialize(),
            success: function(data) {
              $('#modalEditarSolicitacao').modal('hide');
              carregarSolicitacoes();
            }
          });
        });

      });
    </script>
  </body>
</html>